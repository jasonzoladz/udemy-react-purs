"use strict";
var Prelude = require("Prelude");
var Control_Monad_Eff = require("Control.Monad.Eff");
var Control_Monad_Eff_Console = require("Control.Monad.Eff.Console");
var Data_Maybe_Unsafe = require("Data.Maybe.Unsafe");
var Data_Nullable = require("Data.Nullable");
var DOM = require("DOM");
var DOM_HTML = require("DOM.HTML");
var DOM_HTML_Types = require("DOM.HTML.Types");
var DOM_HTML_Window = require("DOM.HTML.Window");
var DOM_Node_NonElementParentNode = require("DOM.Node.NonElementParentNode");
var DOM_Node_Types = require("DOM.Node.Types");
var React = require("React");
var ReactDOM = require("ReactDOM");
var React_DOM = require("React.DOM");
var React_DOM_Props = require("React.DOM.Props");
var Data_RxState = require("Data.RxState");
var Routing = require("Routing");
var Network_HTTP_Affjax = require("Network.HTTP.Affjax");
var BlogRoutes = require("BlogRoutes");
var ActionsEffects = require("ActionsEffects");
var Model = require("Model");
var Channels = require("Channels");
var Components_Pages = require("Components.Pages");
var Effects_AjaxEffects = require("Effects.AjaxEffects");
var Data_Foldable = require("Data.Foldable");
var update = function (model) {
    return function (action) {
        if (action instanceof ActionsEffects.NoOp) {
            return model;
        };
        if (action instanceof ActionsEffects.SetPage) {
            var $5 = {};
            for (var $6 in model) {
                if (model.hasOwnProperty($6)) {
                    $5[$6] = model[$6];
                };
            };
            $5.currPage = action.value0;
            return $5;
        };
        if (action instanceof ActionsEffects.SetPosts) {
            var $8 = {};
            for (var $9 in model) {
                if (model.hasOwnProperty($9)) {
                    $8[$9] = model[$9];
                };
            };
            $8.allPosts = action.value0;
            return $8;
        };
        throw new Error("Failed pattern match at Main line 48, column 3 - line 53, column 1: " + [ action.constructor.name ]);
    };
};
var routingContainer = (function () {
    var displayPage = function (page) {
        return function (state) {
            return Prelude["return"](Control_Monad_Eff.applicativeEff)(React_DOM.div([  ])([ React.createElement(page)(state)([  ]) ]));
        };
    };
    return React.createClass(React.spec(Prelude.unit)(function (ctx) {
        return function __do() {
            var v = React.getProps(ctx)();
            if (v.currPage instanceof BlogRoutes.Index) {
                return displayPage(Components_Pages.index)(v)();
            };
            if (v.currPage instanceof BlogRoutes.Post) {
                return displayPage(Components_Pages.onePost(v.currPage.value0))(v)();
            };
            if (v.currPage instanceof BlogRoutes.NewPost) {
                return displayPage(Components_Pages.newPost)(v)();
            };
            throw new Error("Failed pattern match at Main line 38, column 3 - line 42, column 3: " + [ v.currPage.constructor.name ]);
        };
    }));
})();
var performEffects = function (fxt) {
    if (fxt instanceof ActionsEffects.GoTo) {
        return function __do() {
            Control_Monad_Eff_Console.log("Do some async stuff")();
            return Data_RxState.send([ new ActionsEffects.SetPage(fxt.value0) ])(Channels.actionsChannel)();
        };
    };
    if (fxt instanceof ActionsEffects.NoFx) {
        return Prelude["return"](Control_Monad_Eff.applicativeEff)(Prelude.unit);
    };
    if (fxt instanceof ActionsEffects.FetchPosts) {
        return Effects_AjaxEffects.fetchPosts;
    };
    throw new Error("Failed pattern match at Main line 55, column 3 - line 65, column 1: " + [ fxt.constructor.name ]);
};

/**
 *  Update this soon
 * main :: forall e. Eff (MainEffects e) Unit
 */
var main = (function () {
    var ui = function (model) {
        return React_DOM["div'"]([ React.createFactory(routingContainer)(model) ]);
    };
    var elm$prime = function __do() {
        var v = DOM_HTML.window();
        var v1 = DOM_HTML_Window.document(v)();
        var v2 = DOM_Node_NonElementParentNode.getElementById("app")(DOM_Node_Types.documentToNonElementParentNode(DOM_HTML_Types.htmlDocumentToDocument(v1)))();
        return Data_Maybe_Unsafe.fromJust(Data_Nullable.toMaybe(v2));
    };
    var myRender = function (model) {
        return Prelude["void"](Control_Monad_Eff.functorEff)(Prelude[">>="](Control_Monad_Eff.bindEff)(elm$prime)(ReactDOM.render(ui(model))));
    };
    return function __do() {
        Data_RxState.startApp(Data_Foldable.foldableArray)(update)(performEffects)(myRender)(Channels.actionsChannel)(Channels.effectsChannel)(Model.initialModel)();
        Data_RxState.subscribe(Channels.actionsChannel)(function (action) {
            return Control_Monad_Eff_Console.log(Prelude.show(Prelude.showArray(ActionsEffects.showAction))(action));
        })();
        return Routing.matches(BlogRoutes.routing)(function (old) {
            return function ($$new) {
                return Data_RxState.send([ new ActionsEffects.SetPage($$new) ])(Channels.actionsChannel);
            };
        })();
    };
})();
module.exports = {
    main: main, 
    performEffects: performEffects, 
    update: update, 
    routingContainer: routingContainer
};
